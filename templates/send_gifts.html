{% extends 'base.html' %}

{% load static %}
{% load humanize %}
{% load timefilters %}

{% block title %}
<title>Send Gift - Bixy</title>
<link rel="stylesheet" href="{% static 'css/all_gifts.css' %}">
{% endblock %}


{% block body %}
<div class="heading">
    <h1>Send Gifts</h1>
    <p>Make a random person's day by sending them a gift.</p>
</div>
{% if gifts|length > 0 %}
<div class="card-container">
    {% for gift in gifts %}
    <div class="card">
        <div class="gift-image">
            <img src="{{ gift.image.url }}" alt="Gift image">
        </div>
        <div class="gift-info">
            <h1>{{ gift.name }}</h1>

            <div href="" class="cost">
                <p>{{ gift.cost|intcomma }}</p>
                <img src="{% static 'images/dollar.png' %}" alt="Gift image">
            </div>
        </div>

        <a href="{% url 'buy_gift' gift.id %}">Send</a>
    </div>
    {% endfor %}
</div>
{% else %}
<div class="empty">
    <img src="{% static 'images/empty-box.png' %}" alt="No content image">
    <h1>Feels Empty Here.</h1>
    <a href="{% url 'send_gift' %}">Refresh</a>
</div>
{% endif %}
{% endblock %}

{% block scripts %}
<script>
    fetch("/send-gift/")
        .then(async res => {
            if (res.redirected && res.url.includes('signin')) {
                console.log(res.url)
                const redirect_url = 'http://127.0.0.1:8000/signin/?next=/gifts/send/'
                // window.location.href = res.url;
                window.location.href = redirect_url;
                return
            }
            return res.json()
        })
        .then(data => {
            // console.log(data)
            document.querySelector("#profileSection").innerHTML = data.menu_html;
            // document.querySelector("#main-content").innerHTML = data.main_html;
            // initTimers();
        })
        .catch(() => {
            console.log("Offline or fetch failed");
            
        });

</script>
{% endblock %}
